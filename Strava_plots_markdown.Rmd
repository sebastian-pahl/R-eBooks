---
title: "Strava Plots"
author: "Sebastian Pahl"
output: html_document
---

```{r setup, include = FALSE}
library(ggplot2)
library(dplyr)
library("lubridate")
library("plot3D")
library("plotly")
strava_data <- read.csv("strava_data.csv")
power_curve <- read.csv("power_curve.csv")
lubri_time <- as.character(seconds_to_period(strava_data$hours[length(strava_data$hours)]*60*60))
```

:::: {style="display: grid; grid-template-columns: 1.3fr 2fr; grid-column-gap: 10px;"}

::: {}
**Summary Stats**

```
Total time: `r lubri_time`
Total distance: `r round(strava_data$distance_km[length(strava_data$distance_km)],2)` km
Total elevation gain: `r sum(pmax(0,strava_data$elevation[-1]-head(strava_data$elevation,-1)))` m
```
:::

::: {}
**Elevation Plot**

```{r, echo=FALSE}
ggplot(data = strava_data) +
        geom_point(mapping = aes(x = distance_km, y = elevation, 
                                 colour = pmax(100, pmin(300, power))), 
                   size=2) +
        scale_x_continuous() +
        labs(x = "Distance in km", y = "Elevation in meters", colour = "Power in watts") +
        scale_colour_gradient(low = "yellow", high = "red", na.value = NA) +
        theme(plot.title = element_text(face = "bold", hjust = 0.5))
```
:::

::::

:::: {style="display: grid; grid-template-columns: 1.3fr 2fr; grid-column-gap: 10px;"}

::: {}
**Summary Stats**

```
Peak 1s power: `r round(power_curve$power[1])` watts
Peak 10s power: `r round(power_curve$power[10])` watts
Peak 1m power: `r round(power_curve$power[60])` watts
Peak 5m power: `r round(power_curve$power[60*5])` watts
```
:::

::: {}
**Power Curve**

```{r, echo=FALSE}
ggplot(data = power_curve) +
        geom_line(mapping = aes(x = seconds, y = power), colour = "Red", size = 1.2) +
        labs(x = "Time in Seconds", y = "Power")
```
:::

::::

**3D Elevation Plot**\

```{r, echo=FALSE}
scatter3D(x = strava_data$latitude, y = strava_data$longitude, z =strava_data$elevation,
          colvar = pmax(150, pmin(300, strava_data$power)),
          col = ramp.col(c("yellow", "red")),
          theta=15,  #viewing direction: increasing theta shifts image to the left 
          phi=15,    #viewing direction: increasing phi gives more top view
          bty="g",   #creates an empty perspective box
          type="l",  #or "l" for lines; or "h" for histogram
          lwd=5,
          xlab = "Longitude", ylab = "Latitude", zlab = "Elevation", clab = "Power")
```

**Interactive 3D Elevation Plot**\
This only works if you run the .Rmd file in R studio (not by opening the html in a browser)

```{r, echo = FALSE, message=FALSE}
x <- plot_ly(type = "scatter3d",
        data =strava_data, 
        x = ~latitude, y = ~longitude, z = ~elevation, 
        color = pmax(100, pmin(300, strava_data$power)),
        colors = "YlOrRd", size=3)
        
x <- x %>%  layout(x,scene = list(
                       xaxis = list(title = "latitude"),
                       yaxis = list(title = "longitude"),
                       zaxis = list(title = "elevation"))
               )
x
```

:::: {style="display: grid; grid-template-columns: 1fr 2fr; grid-column-gap: 10px;"}

::: {}

```{r, echo = FALSE}
power_zones <- c(0, 150, 200, 300, 400)
```

**Power Zones**\
\
Zone 1: `r power_zones[1]`-`r power_zones[2]` watts\
Zone 2: `r power_zones[2]`-`r power_zones[3]` watts\
Zone 3: `r power_zones[3]`-`r power_zones[4]` watts\
Zone 4: `r power_zones[4]`-`r power_zones[5]` watts\
Zone 5: `r power_zones[5]`+ watts

:::

::: {}

**Time in Power Zones**

```{r, echo = FALSE, message=FALSE}
ggplot(data = strava_data) +
        geom_bar(mapping = aes(x = power_zone), stat = "count", 
                 fill = "yellow", colour = "red") +
        labs(x = "Power Zones", y = "Time in Zone") +
        theme(plot.title = element_text(face = "bold", hjust = 0.5))
```
:::

::::


:::: {style="display: grid; grid-template-columns: 1fr 2fr; grid-column-gap: 10px;"}

::: {}

```{r, echo = FALSE}
hr_zones <- c(0, 110, 135, 150, 165)
```

**Heart Rate Zones**\
\
Zone 1: `r hr_zones[1]`-`r hr_zones[2]` bbm\
Zone 2: `r hr_zones[2]`-`r hr_zones[3]` bbm\
Zone 3: `r hr_zones[3]`-`r hr_zones[4]` bbm\
Zone 4: `r hr_zones[4]`-`r hr_zones[5]` bbm\
Zone 5: `r hr_zones[5]`+ bbm

:::

::: {}

**Time in Heart Rate Zones**

```{r, echo = FALSE, message=FALSE}
ggplot(data = strava_data) +
        geom_bar(mapping = aes(x = hr_zone), stat = "count", 
                 fill = "yellow", colour = "red") +
        labs(x = "HR Zones", y = "Time in Zone") +
        theme(plot.title = element_text(face = "bold", hjust = 0.5))
```
:::

::::
